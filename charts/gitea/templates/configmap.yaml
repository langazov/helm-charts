apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "gitea.fullname" . }}-config
  labels:
    {{- include "gitea.labels" . | nindent 4 }}
data:
  app.ini: |
    APP_NAME = {{ .Values.gitea.appName }}
    RUN_MODE = prod
    RUN_USER = git

    [server]
    DOMAIN = {{ .Values.gitea.server.domain }}
    ROOT_URL = {{ .Values.gitea.server.rootUrl }}
    HTTP_PORT = {{ .Values.gitea.server.httpPort }}
    DISABLE_SSH = {{ if .Values.gitea.server.startSshServer }}false{{ else }}true{{ end }}
    SSH_PORT = {{ .Values.gitea.server.sshPort }}
    OFFLINE_MODE = false
    LANDING_PAGE = home
    LFS_START_SERVER = false

    [database]
    DB_TYPE = {{ .Values.gitea.database.type }}
    {{- if eq .Values.gitea.database.type "sqlite3" }}
    PATH = /data/gitea/gitea.db
    {{- else if eq .Values.gitea.database.type "postgres" }}
    HOST = {{ .Values.gitea.database.host }}:{{ .Values.gitea.database.port }}
    NAME = {{ .Values.gitea.database.name }}
    USER = {{ .Values.gitea.database.username }}
    PASSWD = {{ .Values.gitea.database.password }}
    SSL_MODE = {{ .Values.gitea.database.sslMode }}
    {{- else if eq .Values.gitea.database.type "mysql" }}
    HOST = {{ .Values.gitea.database.host }}:{{ .Values.gitea.database.port }}
    NAME = {{ .Values.gitea.database.name }}
    USER = {{ .Values.gitea.database.username }}
    PASSWD = {{ .Values.gitea.database.password }}
    CHARSET = utf8mb4
    {{- end }}
    LOG_SQL = false

    [repository]
    ROOT = /data/git/repositories
    SCRIPT_TYPE = bash
    DEFAULT_BRANCH = main
    ENABLE_PUSH_CREATE_USER = false
    ENABLE_PUSH_CREATE_ORG = false

    [repository.local]
    LOCAL_COPY_PATH = /data/gitea/tmp/local-repo

    [repository.upload]
    ENABLED = true
    TEMP_PATH = /data/gitea/uploads
    ALLOWED_TYPES =
    FILE_MAX_SIZE = 3
    MAX_FILES = 5

    [service]
    ACTIVE_CODE_LIVE_MINUTES = 180
    RESET_PASSWD_CODE_LIVE_MINUTES = 180
    REGISTER_EMAIL_CONFIRM = false
    ENABLE_NOTIFY_MAIL = false
    DISABLE_REGISTRATION = false
    REQUIRE_SIGNIN_VIEW = false
    ENABLE_USER_HEATMAP = true
    PUBLIC_ONLY = false
    DEFAULT_KEEP_EMAIL_PRIVATE = false
    DEFAULT_ALLOW_CREATE_ORGANIZATION = true
    DEFAULT_USER_IS_RESTRICTED = false

    [webhook]
    QUEUE_LENGTH = 1000
    DELIVER_TIMEOUT = 5
    SKIP_TLS_VERIFY = false
    PAGING_NUM = 10
    PROXY_IP_WHITELIST =

    [mailer]
    ENABLED = false
    PROTOCOL = smtp
    SMTP_ADDR =
    SMTP_PORT =
    FROM = gitea@example.com
    USER =
    PASSWD =

    [security]
    INSTALL_LOCK = true
    SECRET_KEY = secret-key-placeholder
    INTERNAL_TOKEN_URI = internal-token-uri-placeholder

    [openid]
    ENABLE_OPENID_SIGNIN = true
    ENABLE_OPENID_SIGNUP = true

    [session]
    PROVIDER = memory
    COOKIE_NAME = i_like_gitea
    COOKIE_SECURE = false
    SESSION_LIFE_TIME = 86400

    [cache]
    ADAPTER = memory

    [session.memcache]
    HOST_ADDR =

    [cache.redis]
    HOST_ADDR =

    [picture]
    AVATAR_UPLOAD_PATH = /data/gitea/avatars
    REPOSITORY_AVATAR_UPLOAD_PATH = /data/gitea/repo-avatars
    DISABLE_GRAVATAR = false
    ENABLE_FEDERATED_AVATAR = false

    [attachment]
    ENABLED = true
    PATH = /data/gitea/attachments
    ALLOWED_TYPES = .csv,.pdf,.txt,.docx,.pptx,.xlsx
    MAX_SIZE = 4
    MAX_FILES = 5

    [time]
    FORMAT =

    [log]
    MODE = console
    LEVEL = info
    ROOT_PATH = /data/gitea/log

    [log.console]
    LEVEL =
    STDERR = false

    [other]
    SHOW_FOOTER_VERSION = true
    SHOW_FOOTER_TEMPLATE_LOAD_TIME = true
    ENABLE_FEED = true

    {{- with .Values.gitea.config }}
    {{- range $key, $value := . }}
    {{ $key }} = {{ $value }}
    {{- end }}
    {{- end }}
