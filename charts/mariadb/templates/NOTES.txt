1. Get the MariaDB root password by running:

    kubectl get secret --namespace {{ .Release.Namespace }} {{ include "mariadb.fullname" . }} -o jsonpath="{.data.mariadb-root-password}" | base64 -d

{{- if .Values.auth.username }}

2. Get the MariaDB user password by running:

    kubectl get secret --namespace {{ .Release.Namespace }} {{ include "mariadb.fullname" . }} -o jsonpath="{.data.mariadb-password}" | base64 -d

3. Connect to the database as user "{{ .Values.auth.username }}":

    kubectl run {{ include "mariadb.fullname" . }}-client --rm --tty -i --restart='Never' --image {{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }} --namespace {{ .Release.Namespace }} --command -- mariadb -h {{ include "mariadb.fullname" . }} -u {{ .Values.auth.username }} -p{{ .Values.auth.database }}
{{- else }}

2. Connect to the database as root:

    kubectl run {{ include "mariadb.fullname" . }}-client --rm --tty -i --restart='Never' --image {{ .Values.image.repository }}:{{ .Values.image.tag | default .Chart.AppVersion }} --namespace {{ .Release.Namespace }} --command -- mariadb -h {{ include "mariadb.fullname" . }} -u root -p
{{- end }}

4. To connect from outside the cluster:

{{- if contains "NodePort" .Values.service.type }}

    export NODE_PORT=$(kubectl get --namespace {{ .Release.Namespace }} -o jsonpath="{.spec.ports[0].nodePort}" services {{ include "mariadb.fullname" . }})
    export NODE_IP=$(kubectl get nodes --namespace {{ .Release.Namespace }} -o jsonpath="{.items[0].status.addresses[0].address}")
    echo "MariaDB is available at $NODE_IP:$NODE_PORT"

{{- else if contains "LoadBalancer" .Values.service.type }}

    NOTE: It may take a few minutes for the LoadBalancer IP to be available.
    Watch the status with: kubectl get svc --namespace {{ .Release.Namespace }} -w {{ include "mariadb.fullname" . }}

    export SERVICE_IP=$(kubectl get svc --namespace {{ .Release.Namespace }} {{ include "mariadb.fullname" . }} --template "{{"{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}"}}")
    echo "MariaDB is available at $SERVICE_IP:{{ .Values.service.port }}"

{{- else if contains "ClusterIP" .Values.service.type }}

    kubectl port-forward --namespace {{ .Release.Namespace }} svc/{{ include "mariadb.fullname" . }} 3306:3306 &
    mariadb -h 127.0.0.1 -P 3306 -u root -p

{{- end }}
